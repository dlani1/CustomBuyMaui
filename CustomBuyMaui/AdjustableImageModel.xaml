<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="CustomBuyMaui.ImageAdjustmentPage"
             Title="Ajuste de Imagen"
             BackgroundColor="#F5F5F5">

    <Grid RowDefinitions="*, Auto" Margin="20" ColumnDefinitions="*, 300">

        <!-- Columna 0: Área de Visualización de la Taza -->
        <Frame Grid.Row="0" Grid.Column="0" 
               BackgroundColor="White"
               CornerRadius="10"
               HasShadow="True"
               Padding="15"
               Margin="0,0,15,0">
            
            <StackLayout HorizontalOptions="Center" VerticalOptions="Center">
                
                <Label Text="Vista Previa de la Taza (199mm x 96mm)"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="#1B5E20"
                       HorizontalOptions="Center"
                       Margin="0,0,0,15"/>

                <!-- Área de Diseño Panorámica (Relación 199/96 ~ 2.07:1) -->
                <Frame x:Name="MugAreaFrame"
                       BackgroundColor="#E0E0E0"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       WidthRequest="600" 
                       HeightRequest="290" 
                       CornerRadius="0" 
                       Padding="0"
                       IsClippedToBounds="True">
                    
                    <!-- Lógica de Gestos: Pan (Mover) y Pinch (Zoom) -->
                    <Frame.GestureRecognizers>
                        <PanGestureRecognizer PanUpdated="OnPanUpdated" />
                        <PinchGestureRecognizer PinchUpdated="OnPinchUpdated" />
                    </Frame.GestureRecognizers>

                    <!-- Imagen a Manipular (Se dibuja sobre el Frame) -->
                    <Image x:Name="ImageDisplay"
                           Source="{Binding ImageSource}"
                           Aspect="AspectFill" 
                           HorizontalOptions="Fill" 
                           VerticalOptions="Fill">
                        <!-- El Bindings de TranslationX, Scale y Rotation se aplican en C# -->
                        <Image.Triggers>
                            <DataTrigger TargetType="Image" Binding="{Binding ImageSource}" Value="{x:Null}">
                                <Setter Property="Source" Value="placeholder_image.png"/>
                            </DataTrigger>
                        </Image.Triggers>
                    </Image>
                    
                </Frame>
                
                <Label Text="Usa el mouse/touchpad para mover y hacer zoom."
                       TextColor="Gray"
                       Margin="0,15,0,0"
                       HorizontalOptions="Center"/>
                
            </StackLayout>
        </Frame>

        <!-- Columna 1: Controles de Ajuste -->
        <Frame Grid.Row="0" Grid.Column="1" 
               BackgroundColor="White"
               CornerRadius="10"
               HasShadow="True"
               Padding="20">
            
            <StackLayout Spacing="30">
                
                <Label Text="Controles de Ajuste"
                       FontSize="22"
                       FontAttributes="Bold"
                       TextColor="#1B5E20"/>
                
                <!-- Control de Zoom (Slider) -->
                <StackLayout>
                    <Label x:Name="ScaleLabel" Text="Zoom: 1.00" FontAttributes="Bold"/>
                    <Slider x:Name="ZoomSlider" 
                            Minimum="0.5" 
                            Maximum="3.0" 
                            Value="1.0"
                            ValueChanged="OnZoomSliderValueChanged"
                            ThumbColor="#1B5E20"
                            MaximumTrackColor="#A5D6A7"/>
                </StackLayout>

                <!-- Control de Rotación (Slider) -->
                <StackLayout>
                    <Label x:Name="RotationLabel" Text="Rotación: 0°" FontAttributes="Bold"/>
                    <Slider x:Name="RotationSlider" 
                            Minimum="-180" 
                            Maximum="180" 
                            Value="0"
                            ValueChanged="OnRotationSliderValueChanged"
                            ThumbColor="#1B5E20"
                            MaximumTrackColor="#A5D6A7"/>
                </StackLayout>

                <!-- Botón de Recortar (Corta la parte visible dentro del marco) -->
                <Button Text="Recortar y Aplicar Ajustes"
                        BackgroundColor="#0D47A1" 
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="55"
                        Clicked="OnCropClicked"/>

            </StackLayout>
        </Frame>

        <!-- Fila de Botones (Inferior) -->
        <Grid Grid.Row="1" Grid.ColumnSpan="2" ColumnDefinitions="*, *" Margin="0,20,0,0">
            <Button Text="&#x2b05; Atrás"
                    Grid.Column="0"
                    BackgroundColor="#E0E0E0"
                    TextColor="#616161"
                    CornerRadius="8"
                    HeightRequest="60"
                    Clicked="OnBackClicked"/>
            
            <Button Text="Continuar &#x27a1;"
                    Grid.Column="1"
                    BackgroundColor="#1B5E20"
                    TextColor="White"
                    CornerRadius="8"
                    HeightRequest="60"
                    Clicked="OnNextClicked"/>
        </Grid>

    </Grid>
</ContentPage>